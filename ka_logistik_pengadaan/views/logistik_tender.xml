<odoo>
	<data>
		<record model="ir.ui.view" id="view_logistik_tender_filter">
			<field name="name">logistik.tender.filter</field>
			<field name="model">logistik.tender</field>
			<field name="type">search</field>
			<field name="arch" type="xml">
				<search string="Pencarian">
					<field name="nomor"/>
					<field name="spm_id"/>
					<group expand="0" string="Status Tender">
						<filter name="draft" string="Konsep" domain="[('state','=','draft')]"/>
						<filter name="spp" string="SPPH" domain="[('state','=','spp')]"/>
						<filter name="wait" string="Tg. Persetujuan" domain="[('state','=','wait')]"/>
						<filter name="approved" string="Disetujui" domain="[('state','=','approved')]"/>
						<filter name="sp" string="Sudah SP" domain="[('state','=','sp')]"/>
					</group>
				</search>
			</field>
		</record>

		<record model="ir.ui.view" id="view_logistik_tender_tree">
			<field name="name">logistik.tender.tree</field>
			<field name="model">logistik.tender</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree string="Pengelolaan Tender" colors="grey:state=='sp';blue:state=='draft'">
					<field name="nomor"/>
					<field name="tanggal"/>
					<field name="spm_id"/>
					<field name="tanggal_spm"/>
					<field name="delivery_to"/>
					<field name="company_id" groups="base.group_multi_company"/>
					<field name="state"/>
				</tree>
			</field>
		</record>
		
		<record model="ir.ui.view" id="view_logistik_tender_form">
			<field name="name">logistik.tender.form</field>
			<field name="model">logistik.tender</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Pengelolaan SP">
					<header>
						<button name="action_draft" string="Konsep Tender" type="object" states="spp,wait,approved"/>
						<button name="action_retender" string="Tender Ulang" type="object" states="cancel"/>
						<button name="action_print_spp" string="SPPH Rekanan" icon="fa-print" help="Cetak SPPH untuk masing-masing Rekanan" type="object" states="draft"  class="oe_highlight"/>
						<button name="action_print_spp" string="SPPH Rekanan" icon="fa-print" help="Cetak SPPH untuk masing-masing Rekanan" type="object" states="spp,wait"/>
						<button name="action_print_spp_rekap" string="SPPH Rekap" icon="fa-print" help="Cetak Rekap SPPH" type="object" attrs="{'invisible':[('state','=', 'cancel')]}"/>
						<button name="action_print_result_sementara" string="Hasil Tender Sementara" icon="fa-print" help="Cetak Hasil Tender Sementara" type="object"/>
						<button name="action_print_rangking" string="Hasil Tender" icon="fa-print" help="Cetak Hasil Tender" type="object" states="spp" class="oe_highlight"/>
						<button name="action_print_tender_result" string="Hasil Tender" icon="fa-print" help="Cetak Hasil Tender" type="object" states="wait,sp,approved"/>
						<button name="action_approved" string="Tender Di-Setuji" type="object" states="wait" class="oe_highlight"/>
						<button name="%(action_logistik_tender_cancel)d" string="Batalkan Tender" type="action" states="draft,spp,wait,approved"/>
						<button name="action_create_draft_po" string="Buat Konsep SP" type="object" states="approved" class="oe_highlight"/>
						<!-- <button name="action_dummy" string="Re-Load" type="object" states="draft,spp" class="oe_highlight"/> -->
						<field name="state" widget="statusbar"/>
					</header>
					<sheet class="oe_form_sheet_width_wider">
						<h2>
							<label string="Pengelolaan Tender"/>
						</h2>
						<hr/>
						<group>
							<group>
								<field name="company_id" invisible="1"/>
								<field name="nomor" readonly="1"/> <!-- attrs="{'readonly':[('state','in', ['approved', 'sp', 'cancel'])]}"/> -->
								<field name="tanggal" on_change="onchange_tanggal_tender(tanggal)" attrs="{'readonly':[('state','in', ['approved', 'sp', 'cancel'])]}"/>
								<field name="max_penawaran"  required="1" attrs="{'readonly':[('state','in', ['approved', 'sp', 'cancel'])]}"/>
								<field name="delivery_to" readonly="1"/>
								<field name="tgl_serah"  required="1" attrs="{'readonly':[('state','in', ['approved', 'sp', 'cancel'])]}"/>
							</group>
							<group>
								<h3 colspan="2">
									<label string="Sumber SPM"/>
								</h3>
								<field name="spm_id"/>
								<field name="tanggal_spm"/>
							</group>
						</group>
						<notebook colspan="4">
							<page string="PESERTA TENDER">
								<field name="spp_ids" attrs="{'readonly':[('state','not in', ['draft', 'spp'])]}">
									<tree default_order='partner_id' editable="bottom" colors="grey:state=='confirm';blue:state=='sent';red:state=='norespon'" create="false">
										<button name="action_print_spp" help="Cetak SPPH rekanan ini." icon="fa-print" type="object"/>
										<field name="partner_id"/>
										<button name="action_spph_send" help="Kirim email" type="object" icon=" fa-envelope" groups="base.group_no_one"/>
										<button class="danger" name="action_norespon" help="Rekanan Tidak Merespon" string="Tidak Merespon" attrs="{'invisible':[('tender_state','!=', 'spp')]}" type="object" confirm="Set rekanan tidak merespon?"/>
										<field name="no_penawaran"/>
										<field name="total_spph"/>
										<!-- <button name="action_open_spph_tender" groups="logistik_pengadaan.group_logistik_logistik" icon="fa-pencil-square-o" class="oe_link" help="Input Harga Penawaran" string="SPPH" type="object"/> -->
										<button name="action_open_spph_tender" groups="ka_logistik_pengadaan.group_logistik" icon="fa-pencil-square-o" class="oe_link" help="Input Harga Penawaran" string="SPPH" type="object"/>
										<field name="total" string="Total Nego"/>
										<!-- <button name="action_open_spph_nego" groups="logistik_pengadaan.group_logistik_manager" icon="fa-money" help="Input Harga hasil negosiasi" string="Harga Nego" type="object"/> -->
										<button name="action_open_spph_nego" groups="ka_logistik_pengadaan.group_manager" icon="fa-money" help="Input Harga hasil negosiasi" string="Harga Nego" type="object"/>
										<field name="state" invisible="1"/>
										<field name="tender_state" invisible="1"/>
									</tree>
								</field>
								<div class="oe_right oe_button_box" style="margin-top: 10px">
									<button name="%(action_logistik_tender_rekanan)d" type="action" string="Tambahkan Rekanan" icon="fa-plus-circle" attrs="{'invisible': [('state','not in',['draft', 'spp'])]}"/>
								</div>
							</page>
							<page string="Rangking Barang yang ditenderkan">
								<h3>
									<label string="Klik Barang untuk melihat ranking harga" class="text-primary"/>
								</h3>
								<!-- <field name="line_ids" colspan="6" nolabel="1" attrs="{'readonly':[('state','in', ['wait', 'approved', 'sp', 'cancel'])]}"> -->
								<field name="line_ids" colspan="6" nolabel="1" attrs="{'readonly':[('state','in', ['approved', 'sp', 'cancel'])]}">
									<tree create="false"  delete='false' colors="blue:winner_qty&lt;kuantum;red:winner_qty&gt;kuantum">
										<button name="action_open_histori_harga" type="object" string="Histori Harga" context="{'product_id': product_id}" icon="fa-list"/>
										<field name="product_id"/>
										<field name="spesifikasi"/>
										<field name="unit_id"/>
										<field name="kuantum" string="Kuantum Tender"/>
										<field name="winner_qty"/>
										<field name="lst_price"/>
										<button name="%(ka_logistik_master.action_product_update_hps)d" groups="ka_logistik_pengadaan.group_logistik" type="action" string="Update HPS" icon="fa-repeat"/>
										<field name="pkrat_id"/>
										<field name="winner_info"/>
										<field name="state" invisible="1"/>
										<!-- <button name="unlink" help="Undo status tender menjadi approve" string="Undo" type="object" attrs="{'invisible':[('state', '!=', 'spp')]}"/> -->
										<button name="action_open_ranking" help="Pemilihan Pemenang" string="Pemenang" type="object"  attrs="{'invisible':[('state','in', ['approved', 'sp', 'cancel'])]}"/>
									</tree>
									<form>
										<group>
											<field name="product_id" readonly="1"/> 
											<field name="spesifikasi"/>
											<field name="unit_id" readonly="1"/>
											<newline/>
											<field name="spp_line_ids" colspan="6">
												<tree string="Penawaran Harga" create="false" delete="false" editable="top" colors="blue:menang">
													<field name="partner_id"/>
													<field name="kuantum"/>
													<field name="waktu_kirim"/>
													<field name="penawaran"/>
													<field name="harga"/>
													<field name="total_harga"/>
													<field name="menang" invisible="1"/>
													<button icon="fa-star" name="dump" readonly="1" attrs="{'invisible': [('menang', '=', False)]}"/>
													<field name="keterangan"/>
												</tree>
											</field>
										</group>
									</form>
								</field>
							</page>
							<page string="Informasi SP">
								<field name="order_ids"  attrs="{'readonly':[('state','in', ['approved', 'sp', 'cancel'])]}">
									<tree>
										<field name="name" string="Nomor SP"/>
										<field name="date_order"/>
										<field name="partner_id"/>
										<field name="state"/>
									</tree>
								</field>
							</page>
							<page string="Informasi Tender Batal"  attrs="{'invisible':[('state','!=','cancel')]}">
								<group col="2">
									<field name="cancel_by"/>
									<field name="cancel_date"/>
									<field name="alasan_batal"/>
									<field name="retender_to"/>
								</group>
							</page>
						</notebook>
						<group>
							<field name="note" nolabel="1" class="oe_inline ucase" placeholder="Catatan..."/>
						</group>
					</sheet>
					<div class="oe_chatter">
						<field name="message_follower_ids" widget="mail_followers"/>
						<field name="message_ids" widget="mail_thread"/>
					</div>
				</form>
			</field>
		</record>	
	
		<!-- Rangking Tender-->	
		<record model="ir.ui.view" id="view_tender_ranking_form">
			<field name="name">logistik.tender.lines.form</field>
			<field name="model">logistik.tender.lines</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Pemilihan Pemenang Tender">
					<sheet>
						<group>
							<field name="product_id" readonly="1"/> 
							<field name="spesifikasi"/>
							<field name="unit_id" readonly="1"/>
							<newline/>
							<field name="spp_line_ids" colspan="6">
								<tree string="Penawaran Harga" create="false" delete="false" editable="top" colors="blue:menang">
									<field name="partner_id" />
									<field name="kuantum" readonly="1"/>
									<field name="kuantum_sp"/>
									<field name="waktu_kirim" readonly="1"/>
									<field name="penawaran" readonly="1"/>
									<field name="harga" readonly="1"/>
									<field name="total_harga"/>
									<!--button name="action_set_winner" type="object" icon="checked-box" attrs="{'invisible':[('menang', '=', False)]}"/>
									<button name="action_set_winner" type="object" icon="unchecked-box" attrs="{'invisible':[('menang', '=', True)]}"/-->
									<field name="menang"/>
									<field name="keterangan"/>
								</tree>
							</field>
						</group>
					</sheet>
					<footer>
						<button name="write" type="object" class="oe_button oe_form_button_save oe_highlight" string="Simpan"/> atau <button name="cancel" string="Batal" special="cancel" class="oe_link"/> 
					</footer>
				</form>
			</field>
		</record>
	
		<!-- Histori harga View Layout-->
		<record model="ir.ui.view" id="view_open_histori_harga">
			<field name="name">open.histori.harga.tree</field>
			<field name="model">purchase.order.line</field>
			<field name="priority" eval="100"/>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree  default_order='tanggal_sp desc' string="Detail SP">
					<field name="order_id" string="Nomor SP"/>
					<field name="partner_id"/>
					<field name="tanggal_sp"/>
					<field name="product_qty"/>
					<field name="price_unit"/>
				</tree>
			</field>
		</record>

		<!-- Pembelian Tender -->	
		<record model="ir.actions.act_window" id="action_logistik_tender_tree">
			<field name="name">SPPH - Tender</field>
			<field name="res_model">logistik.tender</field>
			<field name="view_type">form</field>
			<field name="view_mode">form,tree</field>
			<field name="view_id" ref="view_logistik_tender_tree"/>
			<field name="search_view_id" ref="view_logistik_tender_filter"/>
		</record>
	
		<record model="ir.actions.act_window" id="action_logistik_tender_draft_tree">
			<field name="name">Konsep</field>
			<field name="res_model">logistik.tender</field>
			<field name="view_type">form</field>
			<field name="view_mode">form,tree</field>
			<field name="domain">[]</field>
			<field name="context">{'search_default_draft':1}</field>
			<field name="view_id" ref="view_logistik_tender_tree"/>
			<field name="search_view_id" ref="view_logistik_tender_filter"/>
		</record>

		<record model="ir.actions.act_window" id="action_logistik_tender_spp_tree">
			<field name="name">Tunggu Harga</field>
			<field name="res_model">logistik.tender</field>
			<field name="view_type">form</field>
			<field name="view_mode">form,tree</field>
			<field name="domain">[]</field>
			<field name="context">{'search_default_spp':1, 'search_default_wait':1, 'search_default_approved':1}</field>
			<field name="view_id" ref="view_logistik_tender_tree"/>
			<field name="search_view_id" ref="view_logistik_tender_filter"/>
		</record>

		<record model="ir.actions.act_window" id="action_logistik_tender_sp_tree">
			<field name="name">Sudah SP</field>
			<field name="res_model">logistik.tender</field>
			<field name="view_type">form</field>
			<field name="view_mode">form,tree</field>
			<field name="domain">[]</field>
			<field name="context">{'search_default_sp':1}</field>
			<field name="view_id" ref="view_logistik_tender_tree"/>
			<field name="search_view_id" ref="view_logistik_tender_filter"/>
		</record>
	</data>
</odoo>